# TCP/UDP和SCTP

## 缓冲区的大小和限制

+ ipv4数据包最大大小为65535（包括首部），占据16位，**首部为20字节**
+ ipv6数据包最大为65575,包括40字节首部。注意：**净荷长度不包括首部**
  + ipv6特大净荷选项：吧净荷长度扩展到32位。需要MTU（最大传输单元）超过65535数据链路提供
  + Ipv4最小链路mtu为68字节，
  + ipv6最小链路mtu为1280字节
+ 两个人主机之间路径中最小的MTU称为路径MTU
+ 当一个ip数据大小超过相应链路的mtu时候，ipv4和6执行分片
+ ipv4和6都定义了最小重组缓冲区大小，ipv4为576字节，ipv6为1500字节
+ TCP有一个MSS（最大分节大小，用于向对端TCP通告在每个分节中最大的TCP数据量）
  + MSS经常设置为MTU减去IP和TCP首部的固定长度

## TCP输出



# 套接字编程

## 套接字地址结构

均已sockaddr_开头

## ipv4套接字地址结构

sockaddr_in 命名

+ 长度字段sin_len是为了增加对于OSI协议支持
+ 即使有长度字段，无须设置和检查它，除非设计路由套接字
+ POSIX规范只需要要这个结构的三个字段：sin_family、sin_addr、sin_portd。对于符合POSIX的实现来说，定义额外的结构字段是可以接受的
+ 

![](D:\java\自学笔记\个人总结\2019.1\网络编程截图\Snipaste_2019-01-20_11-40-36.png)



#  阻塞和异步

1、最通俗的方式讲解 什么是阻塞/非阻塞，什么是同/异步

        简介：使用最通俗概念讲解 同步异步、堵塞和非堵塞


​        
        洗衣机洗衣服
    
        洗衣机洗衣服（无论阻塞式IO还是非阻塞式IO，都是同步IO模型）


        同步阻塞：你把衣服丢到洗衣机洗，然后看着洗衣机洗完，洗好后再去晾衣服（你就干等，啥都不做，阻塞在那边） 
    
        同步非阻塞：你把衣服丢到洗衣机洗，然后会客厅做其他事情，定时去阳台看洗衣机是不是洗完了，洗好后再去晾衣服
        （等待期间你可以做其他事情，比如用电脑打开小D课堂看视频学习）


​        
        异步阻塞: 你把衣服丢到洗衣机洗，然后看着洗衣机洗完，洗好后再去晾衣服（几乎没这个情况，几乎没这个说法，可以忽略）
        
        异步非阻塞：你把衣服丢到洗衣机洗，然后会客厅做其他事情，洗衣机洗好后会自动去晾衣服，晾完成后放个音乐告诉你洗好衣服并晾好了
# 网络编程模型

 2、(BAT面试核心知识)Linux网络编程中的五种I/O模型讲解上集
        
        简介：linux网络编程中的IO模型讲解上集


​        
        网络IO,用户程序和内核的交互为基础进行讲解
    
        IO操作分两步：发起IO请求等待数据准备，实际IO操作（洗衣服，晾衣服）
        同步须要主动读写数据，在读写数据的过程中还是会阻塞（好比晾衣服阻塞了你） 
        异步仅仅须要I/O操作完毕的通知。并不主动读写数据，由操作系统内核完毕数据的读写（机器人帮你自动晾衣服）


​        
        五种IO的模型：阻塞IO、非阻塞IO、多路复用IO、信号驱动IO和异步IO
        前四种都是同步IO，在内核数据copy到用户空间时都是阻塞的


        权威：RFC标准，或者书籍 《UNIX Network Programming》中文名《UNIX网络编程-卷一》第六章
    
            1）阻塞式I/O；
    
            2）非阻塞式I/O；
    
            3）I/O复用（select，poll，epoll...）；
                I/O多路复用是阻塞在select，epoll这样的系统调用，没有阻塞在真正的I/O系统调用如recvfrom
                进程受阻于select,等待可能多个套接口中的任一个变为可读
    
                IO多路复用使用两个系统调用(select和recvfrom)
                blocking IO只调用了一个系统调用(recvfrom)
                select/epoll 核心是可以同时处理多个connection，而不是更快，所以连接数不高的话，性能不一定比多线程+阻塞IO好
                多路复用模型中，每一个socket，设置为non-blocking,
                阻塞是被select这个函数block，而不是被socket阻塞的